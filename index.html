<!doctype html>
<html lang="pt-BR">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
    <title>Card√°pio ‚Äî Brisa Lounge</title>

    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Poppins:wght@600;700&display=swap"
        rel="stylesheet">

    <style>
        :root {
            --bg: #041024;
            --panel: #071326;
            --muted: #9fb0bf;
            --gold: #D6A84A;
            --gold-2: #FFB86B;
            --glass: rgba(255, 255, 255, 0.03);
            --card-radius: 14px;
            --shadow: 0 12px 36px rgba(2, 8, 20, 0.55);
            --accent-text: #071422;
            font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        * {
            box-sizing: border-box
        }

        html,
        body {
            height: 100%
        }

        body {
            margin: 0;
            background: linear-gradient(180deg, #02061a 0%, var(--bg) 100%);
            color: #eef7fb;
            font-size: 16px;
            line-height: 1.28;
            -webkit-tap-highlight-color: transparent;
        }

        .app {
            min-height: 100vh;
            padding: 14px;
            padding-bottom: 130px;
            display: flex;
            flex-direction: column;
            gap: 12px
        }

        header {
            display: flex;
            gap: 12px;
            align-items: center
        }

        .logo {
            width: 62px;
            height: 62px;
            border-radius: 14px;
            background: linear-gradient(135deg, var(--gold), var(--gold-2));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            color: var(--accent-text);
            font-size: 20px;
            box-shadow: var(--shadow);
            flex: 0 0 62px;
            user-select: none;
            touch-action: manipulation;
        }

        .brand {
            display: flex;
            flex-direction: column
        }

        .brand h1 {
            margin: 0;
            font-size: 18px;
            font-family: Poppins, Inter
        }

        .brand p {
            margin: 0;
            margin-top: 4px;
            color: var(--muted);
            font-size: 13px
        }

        .search-row {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 6px
        }

        .search {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px;
            border-radius: 12px;
            background: var(--glass);
            border: 1px solid rgba(255, 255, 255, 0.03)
        }

        .search svg {
            opacity: 0.95
        }

        .search input {
            border: 0;
            background: transparent;
            outline: none;
            color: inherit;
            font-size: 15px;
            width: 100%
        }

        .list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 6px
        }

        .cat {
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.01), rgba(255, 255, 255, 0.005));
            padding: 12px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.03);
            box-shadow: var(--shadow);
            transition: transform .14s ease, box-shadow .14s;
        }

        .cat:hover {
            transform: translateY(-3px)
        }

        .cat-head {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px
        }

        .cat-name {
            font-family: Poppins, Inter;
            font-weight: 700;
            font-size: 15px
        }

        .cat-meta {
            font-size: 13px;
            color: var(--muted)
        }

        .items {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 10px
        }

        .item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            padding: 12px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.01);
            border: 1px solid rgba(255, 255, 255, 0.02);
            transition: background .12s, transform .12s;
            cursor: pointer;
        }

        .item:active {
            transform: scale(.997)
        }

        .item-left {
            display: flex;
            flex-direction: column;
            gap: 6px;
            max-width: 70%
        }

        .iname {
            font-weight: 600;
            font-size: 15px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis
        }

        .inote {
            font-size: 13px;
            color: var(--muted);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis
        }

        .price {
            font-weight: 800;
            color: var(--gold);
            min-width: 88px;
            text-align: right
        }

        .modal-ingredients {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 8px 0
        }

        .ingredient {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 15px
        }

        .ingredient .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--gold);
            flex: 0 0 10px
        }

        .admin {
            display: none !important
        }

        body.is-admin .admin {
            display: inline-flex !important
        }

        .admin[aria-hidden="true"] {
            pointer-events: none;
            opacity: 0;
            user-select: none
        }

        .fab {
            position: fixed;
            right: 18px;
            bottom: 106px;
            width: 56px;
            height: 56px;
            border-radius: 14px;
            background: linear-gradient(135deg, var(--gold), var(--gold-2));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            color: var(--accent-text);
            border: none;
            box-shadow: 0 12px 36px rgba(3, 7, 18, 0.6);
            z-index: 60;
            cursor: pointer
        }

        .bottom {
            position: fixed;
            left: 12px;
            right: 12px;
            bottom: 14px;
            height: 64px;
            border-radius: 14px;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.01));
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            border: 1px solid rgba(255, 255, 255, 0.03);
            z-index: 70;
            gap: 8px
        }

        .btn {
            padding: 8px 12px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.04);
            background: transparent;
            color: var(--muted);
            font-weight: 600
        }

        .btn.primary {
            background: linear-gradient(90deg, var(--gold), var(--gold-2));
            color: var(--accent-text);
            border: none
        }

        .modal-wrap {
            position: fixed;
            inset: 0;
            display: none;
            align-items: flex-end;
            justify-content: center;
            padding: 18px;
            z-index: 90
        }

        .modal {
            width: 100%;
            max-width: 820px;
            background: linear-gradient(180deg, #071226, #051223);
            border-radius: 14px;
            padding: 14px;
            border: 1px solid rgba(255, 255, 255, 0.03);
            box-shadow: 0 24px 48px rgba(0, 0, 0, 0.6)
        }

        .modal h3 {
            margin: 0;
            font-family: Poppins, Inter
        }

        .frow {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 10px
        }

        .input,
        textarea,
        select {
            width: 100%;
            padding: 10px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.04);
            background: transparent;
            color: inherit;
            font-size: 15px
        }

        .modal-actions {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
            margin-top: 12px
        }

        .modal-wrap.show {
            display: flex
        }

        @media(min-width:720px) {
            .app {
                padding: 22px 40px 160px
            }

            .logo {
                width: 76px;
                height: 76px
            }

            .price {
                min-width: 110px
            }

            .fab {
                right: 28px;
                bottom: 140px
            }

            .bottom {
                left: 24px;
                right: 24px;
                bottom: 28px
            }
        }

        button:focus,
        input:focus,
        select:focus,
        textarea:focus {
            outline: 2px solid rgba(255, 255, 255, 0.06);
            outline-offset: 2px
        }
    </style>
</head>

<body>
    <div class="app" id="app">
        <header>
            <div class="logo" id="logo" title="Toque longo ‚Äî √°rea reservada">BR</div>
            <div class="brand">
                <h1>Brisa Lounge</h1>
                <p>Card√°pio digital.</p>
            </div>
        </header>

        <div class="search-row">
            <div class="search" role="search" aria-label="Pesquisar no card√°pio">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden>
                    <path stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"
                        d="M21 21l-4.35-4.35" />
                    <circle cx="11" cy="11" r="6" stroke="currentColor" stroke-width="1.6" />
                </svg>
                <input id="q" placeholder="Pesquisar (ex: Caipirinha, Heineken)" inputmode="search" />
            </div>
        </div>

        <main id="list" class="list" aria-live="polite"></main>
    </div>

    <button class="fab admin" id="fab" aria-hidden="true" tabindex="-1" title="Adicionar item">+</button>

    <div class="bottom admin" id="bottomBar" aria-hidden="true">
        <div style="display:flex;gap:8px;align-items:center">
            <button id="btnAddCat" class="btn" aria-hidden="true" tabindex="-1">Nova se√ß√£o</button>
            <button id="btnAddItem" class="btn" aria-hidden="true" tabindex="-1">Novo item</button>
            <button id="btnAdmin" class="btn" aria-hidden="true" tabindex="-1">√Årea interna</button>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
            <input id="urlLoad" type="text" placeholder="Cole a URL p√∫blica do card√°pio" aria-hidden="true"
                tabindex="-1"
                style="background:transparent;border:1px solid rgba(255,255,255,0.03);padding:8px;border-radius:8px;color:var(--muted);min-width:140px" />
            <button id="btnLoadUrl" class="btn" aria-hidden="true" tabindex="-1">Trazer</button>
            <button id="btnExport" class="btn" aria-hidden="true" tabindex="-1">Salvar c√≥pia</button>
        </div>
    </div>

    <div id="modalRoot" class="modal-wrap" aria-hidden="true"></div>
    <input id="fileIn" type="file" accept="application/json" style="display:none" />

    <script>

        const LS_KEY = 'cardapio_brisa_v1';
        const ADMIN_HASH_KEY = 'cardapio_brisa_admin_hash';
        const DEFAULT_HASH = '04440fb3544b19f7b83a8a1368a59d1b34a677382d8910c4efa05e1bfcd56c54';

        const uid = (n = 8) => 'id_' + Math.random().toString(36).slice(2, 2 + n);
        const listEl = document.getElementById('list');
        const qInput = document.getElementById('q');
        const logo = document.getElementById('logo');
        const modalRoot = document.getElementById('modalRoot');
        const fileIn = document.getElementById('fileIn');

        let state = loadState() || seedData();
        let isAdmin = false;

        function render() {
            listEl.innerHTML = '';
            const q = qInput.value.trim().toLowerCase();

            state.categories.forEach(cat => {
                const catMatch = cat.name.toLowerCase().includes(q);
                const filtered = cat.items.filter(it => {
                    if (!q) return true;
                    return it.name.toLowerCase().includes(q) || (it.notes || '').toLowerCase().includes(q) || (it.ingredients || []).join(' ').toLowerCase().includes(q);
                });
                if (!catMatch && filtered.length === 0) return;

                const sec = document.createElement('section'); sec.className = 'cat';
                const head = document.createElement('div'); head.className = 'cat-head';
                const left = document.createElement('div'); left.innerHTML = `<div class="cat-name">${escapeHtml(cat.name)}</div><div class="cat-meta">${cat.items.length} itens</div>`;
                head.appendChild(left);

                if (isAdmin) {
                    const right = document.createElement('div'); right.style.display = 'flex'; right.style.gap = '8px';
                    const ed = mkBtn('editar', () => openCatEdit(cat.id));
                    const rm = mkBtn('remover', () => removeCategory(cat.id));
                    right.appendChild(ed); right.appendChild(rm);
                    head.appendChild(right);
                }

                sec.appendChild(head);

                const itemsWrap = document.createElement('div'); itemsWrap.className = 'items';
                filtered.forEach(it => {
                    const itemEl = document.createElement('div'); itemEl.className = 'item'; itemEl.tabIndex = 0;
                    itemEl.addEventListener('click', () => openItemModal(cat.id, it.id));

                    const leftIt = document.createElement('div'); leftIt.className = 'item-left';
                    leftIt.innerHTML = `<div class="iname">${escapeHtml(it.name)}</div>` + (it.notes ? `<div class="inote">${escapeHtml(it.notes)}</div>` : '');

                    const rightIt = document.createElement('div'); rightIt.style.display = 'flex'; rightIt.style.alignItems = 'center'; rightIt.style.gap = '8px';
                    const price = document.createElement('div'); price.className = 'price'; price.textContent = formatBRL(it.price);
                    rightIt.appendChild(price);

                    if (isAdmin) {
                        const e = mkBtn('‚úé', () => openItemEdit(cat.id, it.id));
                        const d = mkBtn('üóë', () => removeItem(cat.id, it.id));
                        rightIt.appendChild(e); rightIt.appendChild(d);
                    }

                    itemEl.appendChild(leftIt);
                    itemEl.appendChild(rightIt);
                    itemsWrap.appendChild(itemEl);
                });

                sec.appendChild(itemsWrap);
                listEl.appendChild(sec);
            });

            toggleAdminUI(isAdmin);
        }

        function mkBtn(label, onClick) {
            const b = document.createElement('button'); b.className = 'btn'; b.textContent = label;
            b.addEventListener('click', (e) => { e.stopPropagation(); onClick(); });
            return b;
        }
        function escapeHtml(s) { if (!s) return ''; return String(s).replace(/[&<>"']/g, c => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[c])); }
        function formatBRL(v) { if (v === undefined || v === '') return ''; return Number(v).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }); }

        function seedData() {
            return {
                updatedAt: new Date().toISOString(),
                categories: [
                    {
                        id: uid(), name: 'Drinks ‚Äî Caipirinhas & Gin', items: [
                            { id: uid(), name: 'Caipirinha de cacha√ßa (300ml)', price: 15.00, notes: 'Escolha: morango ou lim√£o', ingredients: ['cacha√ßa', 'fruta (morango ou lim√£o)', 'a√ß√∫car', 'gelo'] },
                            { id: uid(), name: 'Caipirinha de vodka/saqu√™ (300ml)', price: 20.00, notes: 'Escolha: morango ou lim√£o', ingredients: ['vodka/saqu√™', 'fruta (morango ou lim√£o)', 'a√ß√∫car', 'gelo'] },
                            { id: uid(), name: 'Caipirinha Gourmet Brisa (300ml)', price: 35.00, notes: 'Morango ou lim√£o (vers√£o premium)', ingredients: ['cacha√ßa premium', 'fruta', 'a√ß√∫car', 'gelo', 'toque gourmet'] },
                            { id: uid(), name: 'Gin Eternity (500ml)', price: 10.00, notes: 'Sabores: melancia, tropical, ma√ß√£ verde ou royale', ingredients: ['gin', 'fruta (melancia/tropical/ma√ß√£ verde/royale)', 'gelo'] },
                            { id: uid(), name: 'Gin Eternity (700ml)', price: 15.00, notes: 'Sabores: melancia, tropical, ma√ß√£ verde ou royale', ingredients: ['gin', 'fruta', 'gelo'] },
                            { id: uid(), name: 'Gin Premium & Red Bull', price: 30.00, notes: 'Com fruta (melancia ou tropical)', ingredients: ['gin premium', 'Red Bull', 'gelo', 'fruta'] },
                            { id: uid(), name: 'Cop√£o Premium & Red Bull', price: 40.00, notes: 'Com fruta (melancia ou tropical)', ingredients: ['gin premium/copo grande', 'Red Bull', 'gelo', 'fruta'] },
                            { id: uid(), name: 'Moscow Mule (tradicional)', price: 30.00, ingredients: ['vodka', 'ginger beer', 'lim√£o', 'gelo'] }
                        ]
                    },
                    {
                        id: uid(), name: 'Combos & Garrafas', items: [
                            { id: uid(), name: "Combo Cavalo Branco / Passport / Smirnoff (garrafa + 4 RB + gelo de sabor)", price: 160.00, ingredients: ['garrafa', '4 Red Bull', 'gelo de sabor'] },
                            { id: uid(), name: "Ballantine's / Red Label (garrafa + 4 RB + gelo)", price: 200.00, ingredients: ['garrafa', '4 Red Bull', 'gelo de sabor'] },
                            { id: uid(), name: "Jack Daniel's (Trad., Apple, Honey, Fire) (garrafa + 4 RB + gelo)", price: 280.00, ingredients: ['garrafa', '4 Red Bull', 'gelo de sabor'] },
                            { id: uid(), name: "Old Parr / Black Label (garrafa + 4 RB + gelo)", price: 320.00, ingredients: ['garrafa', '4 Red Bull', 'gelo de sabor'] },
                            { id: uid(), name: "Ciroc / Grey Goose (garrafa + 4 RB + gelo)", price: 320.00, ingredients: ['garrafa', '4 Red Bull', 'gelo de sabor'] },
                            { id: uid(), name: "Gin Tanqueray / Beefeater (garrafa + frutas + 4 RB ou 5 t√¥nicas)", price: 250.00, ingredients: ['garrafa de gin', 'frutas', '4 Red Bull ou 5 t√¥nicas'] }
                        ]
                    },
                    {
                        id: uid(), name: 'Doses & Mix', items: [
                            { id: uid(), name: 'Licor 43 (dose)', price: 18.00, ingredients: ['Licor 43'] },
                            { id: uid(), name: "Ballantine's (dose)", price: 18.00, ingredients: ["Ballantine's"] },
                            { id: uid(), name: 'Tequila (Jos√© Cuervo) (dose)', price: 18.00, ingredients: ['tequila Jos√© Cuervo'] },
                            { id: uid(), name: 'Jack (dose)', price: 30.00, ingredients: ['Jack Daniel\'s'] },
                            { id: uid(), name: 'Chivas 12 anos (garrafa + 4 RB + gelo)', price: 250.00, ingredients: ['garrafa', '4 Red Bull', 'gelo de sabor'] },
                            { id: uid(), name: 'Jack Daniel\'s sabores (garrafa + 4 RB + gelo)', price: 300.00, ingredients: ['garrafa', '4 Red Bull', 'gelo de sabor'] },
                            { id: uid(), name: 'Malibu (dose)', price: 30.00, ingredients: ['Malibu', 'energetico (observa√ß√£o: energ√©tico Bally)'] }
                        ]
                    },
                    {
                        id: uid(), name: 'Cervejas & Baldes', items: [
                            { id: uid(), name: 'Original (600ml)', price: 15.00, ingredients: ['cerveja Original 600ml'] },
                            { id: uid(), name: 'Spaten (600ml)', price: 17.00, ingredients: ['Spaten 600ml'] },
                            { id: uid(), name: 'Heineken (600ml)', price: 19.00, ingredients: ['Heineken 600ml'] },
                            { id: uid(), name: 'Balde Original (4 x 600ml)', price: 56.00, ingredients: ['4 garrafas Original', 'gelo'] },
                            { id: uid(), name: 'Balde Spaten (4 x 600ml)', price: 64.00, ingredients: ['4 garrafas Spaten', 'gelo'] },
                            { id: uid(), name: 'Balde Heineken (4 x 600ml)', price: 72.00, ingredients: ['4 garrafas Heineken', 'gelo'] }
                        ]
                    },
                    {
                        id: uid(), name: 'Long Neck e Diversos', items: [
                            { id: uid(), name: 'Budweiser (long neck)', price: 8.00, ingredients: ['Budweiser long neck'] },
                            { id: uid(), name: 'Spaten (long neck)', price: 10.00, ingredients: ['Spaten long neck'] },
                            { id: uid(), name: 'Corona / Heineken / Heineken 0% (long neck)', price: 12.00, ingredients: ['Corona / Heineken / Heineken 0%'] },
                            { id: uid(), name: 'Skol Beats / Smirnoff Ice', price: 12.00, ingredients: ['Skol Beats ou Smirnoff Ice'] },
                            { id: uid(), name: 'Balde Heineken Long Neck (10 un)', price: 110.00, ingredients: ['10 long neck Heineken', 'gelo'] }
                        ]
                    },
                    {
                        id: uid(), name: 'Bebidas n√£o alco√≥licas', items: [
                            { id: uid(), name: 'Refrigerante ou suco (lata)', price: 6.00, ingredients: ['Coca-Cola / Guaran√° / Sprite / Fanta / Del Valle'] },
                            { id: uid(), name: '√Ågua (com ou sem g√°s)', price: 5.00, ingredients: ['√Ågua com ou sem g√°s'] },
                            { id: uid(), name: '√Ågua t√¥nica', price: 6.00, ingredients: ['√°gua t√¥nica'] },
                            { id: uid(), name: 'Red Bull (sabores)', price: 12.00, ingredients: ['Red Bull (sabores)'] },
                            { id: uid(), name: 'Gelo de sabor', price: 3.00, ingredients: ['gelo de sabor'] },
                            { id: uid(), name: 'Halls / Trident', price: 3.50, ingredients: ['Halls / Trident'] },
                            { id: uid(), name: 'Snickers', price: 6.00, ingredients: ['Snickers'] }
                        ]
                    },
                    {
                        id: uid(), name: 'Narguil√©', items: [
                            { id: uid(), name: 'Narguil√© Rosh', price: 15.00, ingredients: ['corpo Rosh (refil de fumo)'] },
                            { id: uid(), name: 'Aluguel de narguil√©', price: 40.00, notes: 'Cobramos R$5,00 no primeiro aluguel', ingredients: ['base narguil√©', 'mangueira', 'prato', 'carv√£o'] }
                        ]
                    },
                    {
                        id: uid(), name: 'Por√ß√µes & Petiscos', items: [
                            { id: uid(), name: 'Batata com cheddar e bacon', price: 35.00, ingredients: ['batata frita', 'cheddar', 'bacon'] },
                            { id: uid(), name: 'Frango √† passarinho', price: 35.00, ingredients: ['peda√ßos de frango', 'temperos', 'lim√£o'] },
                            { id: uid(), name: 'Isca de frango', price: 45.00, ingredients: ['tirinhas de frango empanadas', 'molho'] },
                            { id: uid(), name: 'Isca de peixe', price: 60.00, ingredients: ['fil√© de peixe empanado', 'molho'] },
                            { id: uid(), name: 'Calabresa com acebolada', price: 30.00, ingredients: ['calabresa', 'cebola', 'temperos'] },
                            { id: uid(), name: 'Onion rings', price: 25.00, ingredients: ['an√©is de cebola empanados'] },
                            { id: uid(), name: 'Salgados fritos', price: 25.00, ingredients: ['coxinha', 'risoles', 'pastel (variedade)'] },
                            { id: uid(), name: 'Por√ß√£o mista', price: 40.00, notes: 'Escolha 2 itens (exceto peixe)', ingredients: ['escolha 2 itens da lista (sem peixe)'] }
                        ]
                    },
                    {
                        id: uid(), name: 'Caldos & Pratos', items: [
                            { id: uid(), name: 'Caldo verde', price: 18.00, ingredients: ['couve', 'batata', 'caldo temperado'] },
                            { id: uid(), name: 'Caldo de feij√£o', price: 18.00, ingredients: ['feij√£o', 'temperos'] },
                            { id: uid(), name: 'Mocot√≥', price: 20.00, ingredients: ['mocot√≥', 'temperos'] },
                            { id: uid(), name: 'Ab√≥bora com carne seca', price: 20.00, ingredients: ['ab√≥bora', 'carne seca'] },
                            { id: uid(), name: 'Por√ß√£o completa', price: 120.00, notes: 'Acompanha isca de peixe + mais 2 op√ß√µes', ingredients: ['isca de peixe', '2 por√ß√µes √† escolha'] }
                        ]
                    },
                    {
                        id: uid(), name: 'T√°buas', items: [
                            { id: uid(), name: 'T√°bua Brisa ‚Äî picanha com batata (‚âà600g)', price: 100.00, notes: 'Acompanha molhos, farofa e vinagrete', ingredients: ['picanha', 'batata', 'molhos', 'farofa', 'vinagrete'] },
                            { id: uid(), name: 'T√°bua ‚Äî lingui√ßa com aligot (‚âà500g)', price: 70.00, notes: 'Aprox. 500g ‚Äî acompanha vinagrete e farofa', ingredients: ['lingui√ßa', 'aligot', 'molhos', 'farofa'] }
                        ]
                    }
                ]
            };
        }

        function loadState() {
            try { const raw = localStorage.getItem(LS_KEY); if (!raw) return null; return JSON.parse(raw); } catch (e) { console.warn('load error', e); return null; }
        }
        function saveState() { state.updatedAt = new Date().toISOString(); localStorage.setItem(LS_KEY, JSON.stringify(state)); }

        async function sha256(str) {
            const buf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(str));
            return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2, '0')).join('');
        }
        function getStoredAdminHash() { return localStorage.getItem(ADMIN_HASH_KEY) || DEFAULT_HASH; }
        async function checkPassword(pw) { const h = await sha256(pw || ''); return h === getStoredAdminHash(); }
        function setAdminHash(hash) { localStorage.setItem(ADMIN_HASH_KEY, hash); }

        let tapCount = 0, lastTap = 0, longpressTimer = null;
        logo.addEventListener('touchstart', startLong); logo.addEventListener('mousedown', startLong);
        logo.addEventListener('touchend', endLong); logo.addEventListener('mouseup', endLong);
        logo.addEventListener('click', () => {
            const t = Date.now();
            if (t - lastTap < 700) tapCount++; else tapCount = 1;
            lastTap = t;
            if (tapCount >= 7) { promptAdmin(); tapCount = 0; }
        });
        function startLong(e) { e.preventDefault && e.preventDefault(); longpressTimer = setTimeout(() => promptAdmin(), 1200); }
        function endLong() { if (longpressTimer) { clearTimeout(longpressTimer); longpressTimer = null; } }
        async function promptAdmin() {
            const pw = prompt('√Årea interna ‚Äî senha:');
            if (pw === null) return;
            const ok = await checkPassword(pw);
            if (ok) { isAdmin = true; render(); alert('√Årea interna liberada'); }
            else alert('Senha incorreta');
        }

        function toggleAdminUI(enable) {
            const adminEls = document.querySelectorAll('.admin');
            adminEls.forEach(el => {
                if (enable) {
                    el.removeAttribute('aria-hidden'); el.removeAttribute('hidden');
                    const controls = el.querySelectorAll('button,input,select,textarea');
                    controls.forEach(c => { c.removeAttribute('tabindex'); c.removeAttribute('aria-hidden'); c.disabled = false; });
                } else {
                    el.setAttribute('aria-hidden', 'true'); el.setAttribute('hidden', '');
                    const controls = el.querySelectorAll('button,input,select,textarea');
                    controls.forEach(c => { c.setAttribute('tabindex', '-1'); c.setAttribute('aria-hidden', 'true'); c.disabled = true; });
                }
            });
            document.body.classList.toggle('is-admin', enable);
        }

        function openModal(element) {
            modalRoot.innerHTML = ''; modalRoot.classList.add('show'); modalRoot.appendChild(element);
            modalRoot.addEventListener('click', onBackdrop); modalRoot.setAttribute('aria-hidden', 'false');
        }
        function closeModal() { modalRoot.removeEventListener('click', onBackdrop); modalRoot.innerHTML = ''; modalRoot.classList.remove('show'); modalRoot.setAttribute('aria-hidden', 'true'); }
        function onBackdrop(e) { if (e.target === modalRoot) closeModal(); }

        function openItemModal(catId, itemId) {
            const cat = state.categories.find(c => c.id === catId); if (!cat) return;
            const it = cat.items.find(i => i.id === itemId); if (!it) return;

            const wrap = document.createElement('div'); wrap.className = 'modal';
            wrap.innerHTML = `<h3>${escapeHtml(it.name)}</h3>`;
            const meta = document.createElement('div'); meta.className = 'frow';
            const price = document.createElement('div'); price.style.fontWeight = '800'; price.textContent = formatBRL(it.price);
            meta.appendChild(price);
            if (it.notes) { const n = document.createElement('div'); n.style.color = 'var(--muted)'; n.textContent = it.notes; meta.appendChild(n); }
            wrap.appendChild(meta);

            if (it.ingredients && it.ingredients.length) {
                const ingWrap = document.createElement('div'); ingWrap.className = 'modal-ingredients';
                const title = document.createElement('div'); title.style.fontWeight = '700'; title.style.marginTop = '6px'; title.textContent = 'Ingredientes';
                ingWrap.appendChild(title);
                it.ingredients.forEach(name => {
                    const row = document.createElement('div'); row.className = 'ingredient';
                    const dot = document.createElement('div'); dot.className = 'dot';
                    const txt = document.createElement('div'); txt.textContent = name;
                    row.appendChild(dot); row.appendChild(txt);
                    ingWrap.appendChild(row);
                });
                wrap.appendChild(ingWrap);
            }

            const actions = document.createElement('div'); actions.className = 'modal-actions';
            const closeBtn = document.createElement('button'); closeBtn.className = 'btn primary'; closeBtn.textContent = 'Fechar'; closeBtn.onclick = () => closeModal();
            actions.appendChild(closeBtn);
            if (isAdmin) {
                const editBtn = document.createElement('button'); editBtn.className = 'btn'; editBtn.textContent = 'Editar'; editBtn.onclick = () => { closeModal(); openItemEdit(catId, itemId); };
                actions.appendChild(editBtn);
            }
            wrap.appendChild(actions);

            openModal(wrap);
        }

        function addCategory(name) {
            state.categories.push({ id: uid(), name: name || 'Nova se√ß√£o', items: [] }); saveState(); render();
        }
        function editCategory(id, name) { const c = state.categories.find(x => x.id === id); if (c) c.name = name; saveState(); render(); }
        function removeCategory(id) { if (!confirm('Remover esta se√ß√£o?')) return; state.categories = state.categories.filter(c => c.id !== id); saveState(); render(); }

        function addItem(catId, payload) { const c = state.categories.find(x => x.id === catId); if (!c) return; c.items.push({ id: uid(), name: payload.name, price: Number(payload.price) || 0, notes: payload.notes || '', ingredients: payload.ingredients || [] }); saveState(); render(); }
        function editItem(catId, itemId, payload) { const c = state.categories.find(x => x.id === catId); if (!c) return; const it = c.items.find(i => i.id === itemId); if (!it) return; it.name = payload.name; it.price = Number(payload.price) || 0; it.notes = payload.notes || ''; it.ingredients = payload.ingredients || []; saveState(); render(); }
        function removeItem(catId, itemId) { if (!confirm('Remover este item?')) return; const c = state.categories.find(x => x.id === catId); if (!c) return; c.items = c.items.filter(i => i.id !== itemId); saveState(); render(); }

        function addCategoryModal() {
            const box = document.createElement('div'); box.className = 'modal';
            box.innerHTML = `<h3>Criar se√ß√£o</h3>`;
            const f = document.createElement('div'); f.className = 'frow';
            const inp = document.createElement('input'); inp.className = 'input'; inp.placeholder = 'Nome da se√ß√£o';
            f.appendChild(inp); box.appendChild(f);
            const actions = document.createElement('div'); actions.className = 'modal-actions';
            const c = document.createElement('button'); c.className = 'btn'; c.textContent = 'Cancelar'; c.onclick = closeModal;
            const s = document.createElement('button'); s.className = 'btn primary'; s.textContent = 'Criar'; s.onclick = () => { if (!inp.value.trim()) return alert('Nome obrigat√≥rio'); addCategory(inp.value.trim()); closeModal(); };
            actions.appendChild(c); actions.appendChild(s); box.appendChild(actions);
            openModal(box);
        }

        function addItemModal() {
            if (!state.categories.length) { alert('Crie uma se√ß√£o primeiro'); return; }
            const box = document.createElement('div'); box.className = 'modal'; box.innerHTML = `<h3>Criar item</h3>`;
            const selRow = document.createElement('div'); selRow.className = 'frow';
            const sel = document.createElement('select'); sel.className = 'input';
            state.categories.forEach(c => { const o = document.createElement('option'); o.value = c.id; o.textContent = c.name; sel.appendChild(o); });
            selRow.appendChild(sel);

            const nameRow = document.createElement('div'); nameRow.className = 'frow'; const nameInp = document.createElement('input'); nameInp.className = 'input'; nameInp.placeholder = 'Nome do item';
            const priceRow = document.createElement('div'); priceRow.className = 'frow'; const priceInp = document.createElement('input'); priceInp.className = 'input'; priceInp.type = 'number'; priceInp.step = '0.01'; priceInp.placeholder = 'Pre√ßo';
            const noteRow = document.createElement('div'); noteRow.className = 'frow'; const noteInp = document.createElement('textarea'); noteInp.className = 'input'; noteInp.rows = 3; noteInp.placeholder = 'Notas (opcional)';
            const ingRow = document.createElement('div'); ingRow.className = 'frow'; const ingInp = document.createElement('input'); ingInp.className = 'input'; ingInp.placeholder = 'Ingredientes (separar por v√≠rgula)';

            box.appendChild(selRow); box.appendChild(nameRow); nameRow.appendChild(nameInp);
            box.appendChild(priceRow); priceRow.appendChild(priceInp);
            box.appendChild(noteRow); noteRow.appendChild(noteInp);
            box.appendChild(ingRow); ingRow.appendChild(ingInp);

            const actions = document.createElement('div'); actions.className = 'modal-actions';
            const cancel = document.createElement('button'); cancel.className = 'btn'; cancel.textContent = 'Cancelar'; cancel.onclick = closeModal;
            const save = document.createElement('button'); save.className = 'btn primary'; save.textContent = 'Salvar'; save.onclick = () => {
                if (!nameInp.value.trim()) return alert('Nome obrigat√≥rio');
                const ingredients = ingInp.value.split(',').map(s => s.trim()).filter(Boolean);
                addItem(sel.value, { name: nameInp.value.trim(), price: parseFloat(priceInp.value || '0'), notes: noteInp.value.trim(), ingredients });
                closeModal();
            };
            actions.appendChild(cancel); actions.appendChild(save); box.appendChild(actions);
            openModal(box);
        }

        function openCatEdit(catId) {
            const cat = state.categories.find(c => c.id === catId); if (!cat) return;
            const box = document.createElement('div'); box.className = 'modal'; box.innerHTML = `<h3>Editar se√ß√£o</h3>`;
            const f = document.createElement('div'); f.className = 'frow'; const inp = document.createElement('input'); inp.className = 'input'; inp.value = cat.name; f.appendChild(inp); box.appendChild(f);
            const actions = document.createElement('div'); actions.className = 'modal-actions';
            const cancel = document.createElement('button'); cancel.className = 'btn'; cancel.textContent = 'Cancelar'; cancel.onclick = closeModal;
            const save = document.createElement('button'); save.className = 'btn primary'; save.textContent = 'Salvar'; save.onclick = () => { if (!inp.value.trim()) return alert('Nome obrigat√≥rio'); editCategory(catId, inp.value.trim()); closeModal(); };
            actions.appendChild(cancel); actions.appendChild(save); box.appendChild(actions);
            openModal(box);
        }

        function openItemEdit(catId, itemId) {
            const cat = state.categories.find(c => c.id === catId); if (!cat) return; const it = cat.items.find(i => i.id === itemId); if (!it) return;
            const box = document.createElement('div'); box.className = 'modal'; box.innerHTML = `<h3>Editar item</h3>`;
            const nameRow = document.createElement('div'); nameRow.className = 'frow'; const nameInp = document.createElement('input'); nameInp.className = 'input'; nameInp.value = it.name; nameRow.appendChild(nameInp);
            const priceRow = document.createElement('div'); priceRow.className = 'frow'; const priceInp = document.createElement('input'); priceInp.className = 'input'; priceInp.type = 'number'; priceInp.step = '0.01'; priceInp.value = it.price; priceRow.appendChild(priceInp);
            const noteRow = document.createElement('div'); noteRow.className = 'frow'; const noteInp = document.createElement('textarea'); noteInp.className = 'input'; noteInp.rows = 3; noteInp.value = it.notes || ''; noteRow.appendChild(noteInp);
            const ingRow = document.createElement('div'); ingRow.className = 'frow'; const ingInp = document.createElement('input'); ingInp.className = 'input'; ingInp.value = (it.ingredients || []).join(', ');
            ingRow.appendChild(ingInp);
            box.appendChild(nameRow); box.appendChild(priceRow); box.appendChild(noteRow); box.appendChild(ingRow);
            const actions = document.createElement('div'); actions.className = 'modal-actions';
            const cancel = document.createElement('button'); cancel.className = 'btn'; cancel.textContent = 'Cancelar'; cancel.onclick = closeModal;
            const save = document.createElement('button'); save.className = 'btn primary'; save.textContent = 'Salvar'; save.onclick = () => {
                if (!nameInp.value.trim()) return alert('Nome obrigat√≥rio');
                const ingredients = ingInp.value.split(',').map(s => s.trim()).filter(Boolean);
                editItem(catId, itemId, { name: nameInp.value.trim(), price: parseFloat(priceInp.value || '0'), notes: noteInp.value.trim(), ingredients });
                closeModal();
            };
            actions.appendChild(cancel); actions.appendChild(save); box.appendChild(actions);
            openModal(box);
        }

        /* ---------- import / export / load ---------- */
        function exportJSON() {
            const blob = new Blob([JSON.stringify(state, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'cardapio_brisa.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
        }
        function importJSON(file) {
            const r = new FileReader(); r.onload = () => {
                try {
                    const json = JSON.parse(r.result);
                    if (!json || !Array.isArray(json.categories)) throw new Error('Formato inv√°lido');
                    if (!confirm('Substituir o card√°pio atual?')) return;
                    state = json; saveState(); render(); alert('Card√°pio atualizado');
                } catch (e) { alert('Erro: ' + e.message); }
            }; r.readAsText(file);
        }
        async function loadFromUrl(url) {
            if (!url) return alert('Cole a URL p√∫blica antes');
            try {
                const res = await fetch(url, { cache: 'no-store' });
                if (!res.ok) throw new Error('HTTP ' + res.status);
                const json = await res.json();
                if (!json || !Array.isArray(json.categories)) throw new Error('Formato inv√°lido');
                if (!confirm('Substituir o card√°pio local pelo remoto?')) return;
                state = json; saveState(); render(); alert('Carregado');
            } catch (e) { alert('Erro ao carregar: ' + e.message); }
        }

        /* ---------- quick add (admin FAB) ---------- */
        function quickAdd() {
            if (!state.categories.length) { alert('Crie uma se√ß√£o antes'); return; }
            const name = prompt('Nome do item:'); if (!name) return;
            const priceRaw = prompt('Pre√ßo (ex: 15.50):', '0'); if (priceRaw === null) return;
            const price = parseFloat(priceRaw.replace(',', '.')) || 0;
            const cat = state.categories[0];
            addItem(cat.id, { name: name.trim(), price, notes: '', ingredients: [] });
        }

        /* ---------- bindings ---------- */
        qInput.addEventListener('input', () => render());
        document.getElementById('fab').addEventListener('click', () => { if (!isAdmin) return; quickAdd(); });
        document.getElementById('btnAddCat').addEventListener('click', () => { if (!isAdmin) return; addCategoryModal(); });
        document.getElementById('btnAddItem').addEventListener('click', () => { if (!isAdmin) return; addItemModal(); });
        document.getElementById('btnAdmin').addEventListener('click', () => { if (!isAdmin) return; openAdminPanel(); });
        document.getElementById('btnExport').addEventListener('click', () => { if (!isAdmin) return; exportJSON(); });
        document.getElementById('btnLoadUrl').addEventListener('click', () => { if (!isAdmin) return; const url = document.getElementById('urlLoad').value.trim(); if (url) loadFromUrl(url); });
        fileIn.addEventListener('change', (e) => { const f = e.target.files[0]; if (!f) return; if (!isAdmin) return; importJSON(f); e.target.value = ''; });
        document.addEventListener('keydown', (e) => { if (e.key === '/' && document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA') { e.preventDefault(); qInput.focus(); } });

        /* ---------- small admin panel ---------- */
        function openAdminPanel() {
            const box = document.createElement('div'); box.className = 'modal'; box.innerHTML = `<h3>√Årea interna</h3>`;
            const change = document.createElement('button'); change.className = 'btn'; change.textContent = 'Trocar senha'; change.onclick = () => { closeModal(); changePasswordModal(); };
            const exp = document.createElement('button'); exp.className = 'btn'; exp.textContent = 'Salvar c√≥pia'; exp.onclick = () => { exportJSON(); closeModal(); };
            const imp = document.createElement('button'); imp.className = 'btn'; imp.textContent = 'Importar arquivo'; imp.onclick = () => { closeModal(); fileIn.click(); };
            const reset = document.createElement('button'); reset.className = 'btn'; reset.textContent = 'Resetar card√°pio'; reset.onclick = () => { if (confirm('Resetar para os dados iniciais?')) { state = seedData(); saveState(); render(); closeModal(); } };
            const row = document.createElement('div'); row.className = 'row'; row.style.gap = '8px'; row.style.marginTop = '12px';
            row.appendChild(change); row.appendChild(exp); row.appendChild(imp); row.appendChild(reset);
            box.appendChild(row);
            const closeBtn = document.createElement('div'); closeBtn.className = 'modal-actions';
            const c = document.createElement('button'); c.className = 'btn'; c.textContent = 'Fechar'; c.onclick = closeModal; closeBtn.appendChild(c);
            box.appendChild(closeBtn);
            openModal(box);
        }

        function changePasswordModal() {
            const box = document.createElement('div'); box.className = 'modal'; box.innerHTML = `<h3>Alterar senha</h3>`;
            const cur = document.createElement('input'); cur.className = 'input'; cur.type = 'password'; cur.placeholder = 'Senha atual';
            const nw = document.createElement('input'); nw.className = 'input'; nw.type = 'password'; nw.placeholder = 'Nova senha';
            const nw2 = document.createElement('input'); nw2.className = 'input'; nw2.type = 'password'; nw2.placeholder = 'Confirmar nova senha';
            const wrap = document.createElement('div'); wrap.className = 'frow'; wrap.appendChild(cur); wrap.appendChild(nw); wrap.appendChild(nw2); box.appendChild(wrap);
            const actions = document.createElement('div'); actions.className = 'modal-actions';
            const cancel = document.createElement('button'); cancel.className = 'btn'; cancel.textContent = 'Cancelar'; cancel.onclick = closeModal;
            const save = document.createElement('button'); save.className = 'btn primary'; save.textContent = 'Salvar'; save.onclick = async () => {
                if (!cur.value || !nw.value) return alert('Preencha todos os campos');
                if (nw.value !== nw2.value) return alert('Confirma√ß√£o n√£o confere');
                const ok = await checkPassword(cur.value);
                if (!ok) return alert('Senha atual incorreta');
                const newHash = await sha256(nw.value);
                setAdminHash(newHash);
                alert('Senha alterada');
                closeModal();
            };
            actions.appendChild(cancel); actions.appendChild(save); box.appendChild(actions);
            openModal(box);
        }

        /* ---------- init / autosave ---------- */
        render();
        setInterval(() => saveState(), 5000);

        /* ---------- expose for power-user ---------- */
        window.brisaCardapio = {
            get: () => JSON.parse(JSON.stringify(state)),
            login: async (pw) => { if (await checkPassword(pw)) { isAdmin = true; render(); return true; } return false; },
            logout: () => { isAdmin = false; render(); },
            reset: () => { if (confirm('Resetar para dados iniciais?')) { state = seedData(); saveState(); render(); } }
        };
    </script>
</body>

</html>
